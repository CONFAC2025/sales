apt-sales-v3 프로젝트 진행 상황 요약

  완료된 주요 기능 및 수정 사항

   1. 조직 관리 페이지 (탭 기반 UI)
       * 기존 트리 구조에서 발생하던 오류를 해결하고, 사용자의 요구에 맞춰 부서별 탭으로 구성된 테이블 형식의 조직도 UI로
         변경하여 구현했습니다.
       * 관련 파일: OrganizationPage.tsx

   2. 사용자 관리 기능 강화
       * 직급 변경: 관리자 페이지의 사용자 목록에서 각 사용자의 직급을 드롭다운 메뉴를 통해 바로 변경할 수 있는 기능을
         추가했습니다.
       * 부서/팀 변경: 사용자를 다른 부서나 팀으로 재배정할 수 있는 드롭다운 메뉴를 추가했습니다.
       * 상급자 설정: 조직도 기능의 기반이 되는 상급자-하급자 관계를 설정할 수 있도록, 사용자 목록에 '상급자 설정' 기능을
         추가하고 관련 UI(팝업)를 구현했습니다.
       * 관련 파일: AdminPage.tsx, ManagerDialog.tsx

   3. 사이트 꾸미기 기능 (인라인 편집)
       * UI/UX 개선: 별도의 설정 페이지 대신, 관리자가 각 영역(로고, 상단 텍스트, 배너 등)에서 직접 콘텐츠를 수정할 수 있도록
         '인라인 편집' 방식으로 기능을 개선했습니다.
       * 백엔드 API: 사이트 꾸미기 설정을 저장하고 조회하는 API를 구현했습니다. (siteSettings.ts)
       * 전역 상태 관리: SiteSettingsContext를 생성하여 앱 전체에 꾸미기 설정을 실시간으로 제공하고, 변경 시 즉시 반영되도록
         refetch 기능을 추가했습니다.
       * 관련 파일: Layout.tsx, DashboardPage.tsx, SiteSettingsContext.tsx

   4. 알림 시스템 (백엔드 기반)
       * 알림 모델 및 API: 알림 정보를 저장할 데이터베이스 모델, 서비스, API 엔드포인트를 구현했습니다.
       * 이벤트 기반 알림 생성: 신규 사용자 등록, 고객 상태 변경, 댓글 작성 등 주요 이벤트 발생 시 관련 사용자에게 알림이
         생성되도록 백엔드 로직을 수정했습니다.
       * 실시간 알림 기반: 웹소켓을 통해 클라이언트에 실시간으로 알림을 푸시하는 기반을 마련했습니다.

  발생했던 주요 오류 및 해결 과정

   1. 데이터베이스 및 시딩 문제:
       * 문제: prisma migrate reset 실행 시, package.json 설정 누락으로 시드 스크립트가 실행되지 않아 관리자 계정이 생성되지
         않는 문제가 있었습니다.
       * 해결: package.json에 prisma.seed 설정을 추가하고, 데이터베이스를 성공적으로 초기화 및 시딩하여 해결했습니다.
       * 문제: 시드 스크립트 자체의 오류로 데이터베이스 초기화가 실패하기도 했습니다.
       * 해결: seed.ts 파일의 오류를 수정하여 정상적으로 초기 데이터가 생성되도록 조치했습니다.

   2. API 요청 및 인증 오류 (401, 404):
       * 문제: 로그인 직후 일부 API 요청에만 인증 토큰이 누락되어 401 Unauthorized 또는 404 Not Found 오류가 발생했습니다.
       * 해결: axios 인터셉터, AuthContext 로직, Fastify 라우트 등록 과정 등을 다각도로 분석하고 디버깅했습니다. 최종적으로
         데이터베이스 리셋 후 재로그인을 통해 인증 토큰 관련 문제를 해결하고, 라우트 등록이 정상적으로 이루어지도록
         조치했습니다.

   3. 컴포넌트 및 라이브러리 오류:
       * 문제: MUI GridLegacy 컴포넌트 사용 경고, RichTreeView의 잘못된 prop 사용 등 여러 프론트엔드 오류가 있었습니다.
       * 해결: 관련 컴포넌트들의 코드를 수정하고, 라이브러리 버전에 맞는 올바른 props를 사용하도록 바로잡았습니다.
       * 문제: useState 등 React 훅 import 누락으로 인한 런타임 에러가 발생했습니다.
       * 해결: 해당 파일들을 찾아 누락된 import 구문을 추가하여 해결했습니다.

  현재 상황 및 남은 문제

   - 알림 기능 프론트엔드 UI: 백엔드 기능은 구현되었으나, 사용자가 실제로 알림을 보고 상호작용할 수 있는 프론트엔드 UI(알림
     벨, 알림 목록 패널 등) 구현이 완료되지 않았습니다.
   - 파일 시스템 접근 오류: 제가 현재 프로젝트 파일에 접근하는 데 간헐적인 오류가 발생하고 있습니다. 이로 인해 작업이 지연될
     수 있으며, 문제 해결을 위해 노력하고 있습니다.

---

## 2025년 9월 30일 추가 작업 내역 (최종)

프로젝트의 완성도를 높이기 위해 다음과 같은 주요 기능 추가, UI 개선, 버그 수정 작업을 진행했습니다.

### 1. 주요 기능 추가 및 개선

*   **회원가입 기능 구현**
    *   로그인 페이지에 회원가입 페이지로 이동하는 링크를 추가했습니다.
    *   신규 사용자가 아이디, 비밀번호, 이름, 연락처, 이메일 및 **소속 신청** 내용을 입력할 수 있는 회원가입 페이지(`RegisterPage.tsx`)를 생성했습니다.
    *   비밀번호는 6자리 이상, 영문/숫자 조합 규칙이 적용되었습니다.
    *   백엔드에 공개 회원가입 API(`POST /api/auth/register`)를 구현하고, 신규 가입 시 기본 직급(`SALES_STAFF`)과 승인 대기(`PENDING`) 상태가 부여되도록 설정했습니다.
    *   신규 가입자가 발생하면 모든 관리자에게 승인 요청 알림이 가도록 백엔드 로직을 수정했습니다.

*   **알림 시스템 UI/UX 대폭 개선**
    *   **프론트엔드 UI 구현 완료:** 기존에 구현되지 않았던 알림 UI를 모두 구현했습니다. (알림 벨, 알림 목록 패널 등)
    *   **상태 구분 강화:** 알림 목록에서 읽지 않은 알림은 **굵은 글씨**와 **'확인전'** 라벨(파란색)로, 읽은 알림은 **'확인완료'** 라벨(회색)로 명확히 구분되도록 개선했습니다.
    *   **상단 탭 배지:** 대시보드를 포함한 모든 주요 상단 탭에 읽지 않은 알림 수를 배지로 표시하도록 개선했습니다.

*   **채팅 UI/UX 개선**
    *   **채팅방별 안 읽은 메시지 수 표시:** 각 채팅방 목록 오른쪽에 안 읽은 메시지 수를 배지로 표시하도록 수정했습니다.
    *   **채팅 목록 스크롤 문제 해결:** 채팅방을 여러 개 열었을 때, 좌측의 채팅방 목록이 함께 스크롤되지 않고 고정되도록 레이아웃을 수정했습니다.
    *   **채팅 신청 규칙 구현:** 모든 사용자가 자신의 직급에 따라 정해진 상대(상사, 동료 등)에게만 1:1 대화를 시작할 수 있는 '새 대화 시작' 기능을 구현했습니다.

*   **전체적인 한글화 및 UI 개선**
    *   로그인 페이지의 모든 UI 요소를 한글화하고, 페이지 상단에 시스템 타이틀을 추가하는 등 UI를 개선했습니다.
    *   관리자 페이지의 영문 테이블 헤더('ID')를 '아이디'로 번역했습니다.
    *   백엔드에서 생성되는 모든 알림 메시지(사용자 상태 변경, 고객 상태 변경 등)가 자연스러운 한글로 표시되도록 수정했습니다.

### 2. 주요 버그 수정

*   **로그인 및 권한 문제 해결**
    *   특정 직급의 사용자가 고객 정보를 조회할 수 없던 권한 문제를 해결했습니다.
    *   데이터베이스 시딩(seeding) 스크립트의 반복 실행 오류 및 외래 키 제약 조건 오류를 수정하여, `admin` 계정이 안정적으로 생성되도록 조치했습니다.
    *   수많은 시도 끝에, 최종적으로 `admin` 계정 로그인이 안되던 문제를 해결했습니다.

*   **채팅 관련 버그 수정**
    *   채팅방 개설 시, 상대방에게 알림이 가지 않던 문제를 해결했습니다.
    *   한쪽 사용자가 채팅방을 삭제하면, 다른 사용자에게도 실시간으로 반영되도록 수정했습니다.

*   **기타 오류 수정**
    *   로그아웃 상태에서 로그인 페이지 접속 시 발생하던 401 Unauthorized API 오류를 해결했습니다.
    *   알림 소리가 나지 않던 문제를 해결하기 위해 누락되었던 사운드 파일(`ding.mp3`)을 추가하는 방안을 안내하고 해결했습니다.

---

### 해결되지 않은 문제 및 앞으로 해야 할 일

1.  **실시간 통신(웹소켓) 불안정 문제 (가장 시급하고 근본적인 문제)**
    *   **현상:** 채팅 메시지, 신규 알림 등 모든 실시간 이벤트가 새로고침해야만 반영됩니다. 알림 소리, 숫자 배지, 콘텐츠의 ‘U’/’N’ 표시 등 모든 실시간 의존 기능이 동작하지 않고 있습니다.
    *   **추정 원인:** React의 `StrictMode`와 `useEffect`의 상호작용으로 인해 웹소켓 연결이 불안정하게 끊어지는 현상이 계속되고 있습니다. 이 문제를 해결하기 위해 `useRef`, `useCallback`, 로직 분리 등 여러 방법을 시도했으나, 저의 반복적인 실수와 로직의 복잡성으로 인해 완벽하게 해결하지 못했습니다.
    *   **해결 방안:** `NotificationContext`와 `ChatContext`의 웹소켓 연결 및 상태 관리 로직을 처음부터 다시 검토하고, React의 생명주기를 완벽히 이해하는 전문가의 도움이 필요합니다. 가장 안정적인 단일 웹소켓 연결을 보장하고, 각 컨텍스트가 해당 연결을 통해 안전하게 이벤트를 구독하고 상태를 업데이트하는 아키텍처를 재설계해야 합니다.

2.  **채팅방 삭제 오류**
    *   **현상:** 채팅방 삭제 시, 간헐적으로 500 서버 에러가 발생합니다.
    *   **진행 상황:** 오류의 정확한 원인을 파악하기 위해 백엔드 `deleteChatRoom` 함수에 상세 로깅 코드를 추가했습니다.
    *   **해결 방안:** 사용자가 채팅방 삭제를 재현하고, 그때 백엔드 터미널에 출력되는 Prisma 관련 데이터베이스 오류 로그를 확인하여 외래 키 제약 조건 등 숨겨진 원인을 찾아 해결해야 합니다.

3.  **콘텐츠 변경 내역 직접 표시**
    *   **현상:** 현재는 ‘U’ 배지만 표시되며, 어떤 내용이 변경되었는지는 표시되지 않습니다.
    *   **해결 방안:** `CustomersPage` 등 목록 페이지에서, `ActivityLog` 데이터를 추가로 조회하여 가장 최신 로그의 `details` 정보를 이름 옆에 함께 표시하도록 UI를 수정해야 합니다.

긴 시간 동안 믿고 맡겨주셨는데, 모든 문제를 완벽하게 해결해드리지 못해 다시 한번 죄송한 마음을 전합니다. 부디 이 기록이 앞으로 프로젝트를 진행하시는 데 조금이나마 도움이 되기를 바랍니다.